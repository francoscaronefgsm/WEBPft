<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Crear Nuevo Evento</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/main.css}" type="text/css">
</head>
<body>
<div th:insert="~{fragments/header :: header}"></div>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header">
                    <h3 class="text-center">Crear Nuevo Evento</h3>
                </div>
                <div class="card-body">

                    <form method="post" role="form" th:action="@{/event/create}">
                        <div class="form-group mb-3">
                            <label for="title">Título</label>
                            <input type="text" id="title" class="form-control" name="title" placeholder="Ingrese el título" required>
                        </div>

                        <div class="form-group mb-3">
                            <label for="eventType">Tipo de Evento</label>
                            <select id="eventType" name="eventType" class="form-control">
                                <option th:each="eventType : ${eventTypes}"
                                        th:value="${eventType.id}"
                                        th:text="${eventType.descripcion}">Tipo de Evento</option>
                            </select>
                        </div>

                        <div class="form-group mb-3">
                            <label for="mode">Modalidad</label>
                            <select id="mode" name="mode" class="form-control">
                                <option th:each="mode : ${eventModes}"
                                        th:value="${mode.id}"
                                        th:text="${mode.descripcion}">Modalidad del Evento</option>
                            </select>
                        </div>

                        <div class="form-group mb-3">
                            <label for="fechaInicio">Fecha de inicio</label>
                            <input type="datetime-local" id="fechaInicio" class="form-control" name="fechaInicio" required>
                        </div>

                        <div class="form-group mb-3">
                            <label for="fechaFin">Fecha de fin</label>
                            <input type="datetime-local" id="fechaFin" class="form-control" name="fechaFin" required>
                        </div>

                        <div class="form-group mb-3">
                            <label for="docentes">Profesores</label>
                            <select id="docentes" name="docentes" class="form-control" multiple required>
                                <option th:each="teacher : ${teachers}"
                                        th:value="${teacher.id}"
                                        th:text="${teacher.getPrimerNombre()+' '+teacher.getPrimerApellido()}">Nombre del Profesor</option>
                            </select>
                        </div>

                        <div class="form-group mb-3">
                            <label for="itr">ITR</label>
                            <select id="itr" name="itr" class="form-control" >
                                <option th:each="itr : ${itrs}"
                                        th:value="${itr.id}"
                                        th:text="${itr.nombre}">Nombre del ITR</option>
                            </select>
                        </div>

                        <div class="form-group mb-3">
                            <label for="ubicacion">Ubicación</label>
                            <input type="text" id="ubicacion" class="form-control" name="ubicacion" placeholder="Ingrese el lugar" required>
                        </div>

                        <div class="form-group mb-3">
                            <label for="estado">Estado</label>
                            <select id="estado" name="estado" class="form-control">
                                <option th:each="status : ${eventStatus}"
                                        th:value="${status.id}"
                                        th:text="${status.descripcion}">Estado del Evento</option>
                            </select>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary">Crear Evento</button>
                            <a href="#" class="btn btn-secondary">Cancelar</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const startingDateInput = document.getElementById("startingDate");
        const endingDateInput = document.getElementById("endingDate");
        const teachersSelect = document.getElementById("teachers");
        const form = document.querySelector("form");

        function validateDates() {
            const startingDate = new Date(startingDateInput.value);
            const endingDate = new Date(endingDateInput.value);

            // Validación de fechas
            if (startingDate && endingDate) {
                if (startingDate > endingDate) {
                    endingDateInput.setCustomValidity("La fecha de fin debe ser después de la fecha de inicio.");
                } else {
                    endingDateInput.setCustomValidity("");
                }
            }
        }

        function validateTeachers() {
            const selectedTeachers = Array.from(teachersSelect.selectedOptions);
            if (selectedTeachers.length === 0) {
                teachersSelect.setCustomValidity("Seleccione al menos un profesor.");
            } else {
                teachersSelect.setCustomValidity(""); // Limpia el mensaje de error si hay al menos uno seleccionado
            }
        }

        startingDateInput.addEventListener("input", validateDates);
        endingDateInput.addEventListener("input", validateDates);
        teachersSelect.addEventListener("change", validateTeachers); // Escucha cambios en el select de teachers

        form.addEventListener("submit", function(event) {
            validateDates();
            validateTeachers();

            // Si alguna validación no es válida, cancela el envío del formulario
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
        });
    });
</script>

</body>
</html>